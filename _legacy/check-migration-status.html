<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      max-width: 1000px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #007bff;
      padding-bottom: 10px;
    }
    #result {
      background: #000;
      color: #0f0;
      padding: 20px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      min-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
      white-space: pre-wrap;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 20px 0;
    }
    .stat-card {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #007bff;
    }
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: #007bff;
    }
    .stat-label {
      font-size: 14px;
      color: #666;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“Š ìŠ¤ì¼€ì¤„ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸</h1>
    
    <div style="background: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
      <strong>â„¹ï¸ ì•ˆë‚´:</strong> ì´ ë„êµ¬ëŠ” í˜„ì¬ schedules ì»¬ë ‰ì…˜ì˜ êµ¬ì¡°ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
    </div>

    <button onclick="checkStatus()">ğŸ” ìƒíƒœ í™•ì¸</button>
    
    <div class="stats" id="stats" style="display: none;">
      <div class="stat-card">
        <div class="stat-value" id="totalDocs">-</div>
        <div class="stat-label">ì´ ë¬¸ì„œ ìˆ˜</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="structureType">-</div>
        <div class="stat-label">ë°ì´í„° êµ¬ì¡°</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="needsMigration">-</div>
        <div class="stat-label">ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”</div>
      </div>
    </div>

    <div id="result"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyCr3Tq2T7oy5rVlK1c33m_G0TlUWv0-g3k",
      authDomain: "abcdc-staff-system.firebaseapp.com",
      projectId: "abcdc-staff-system",
      storageBucket: "abcdc-staff-system.firebasestorage.app",
      messagingSenderId: "442207878284",
      appId: "1:442207878284:web:49b157573851b124d28fa9",
      measurementId: "G-WYPQ3YEJRT"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function log(message) {
      const resultDiv = document.getElementById('result');
      const timestamp = new Date().toLocaleTimeString('ko-KR');
      resultDiv.textContent += `[${timestamp}] ${message}\n`;
      console.log(message);
    }

    async function checkStatus() {
      try {
        document.getElementById('result').textContent = '';
        log('ğŸ” schedules ì»¬ë ‰ì…˜ ë¶„ì„ ì‹œì‘...\n');

        // schedules ì»¬ë ‰ì…˜ ì¡°íšŒ (ìµœëŒ€ 10ê°œë§Œ)
        const snapshot = await db.collection('schedules').limit(10).get();
        
        if (snapshot.empty) {
          log('âš ï¸ schedules ì»¬ë ‰ì…˜ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
          return;
        }

        log(`ğŸ“Š ì´ ${snapshot.size}ê°œ ë¬¸ì„œ ìƒ˜í”Œ ì¡°íšŒ (ìµœëŒ€ 10ê°œ)\n`);

        let weeklyStructureCount = 0;
        let dailyStructureCount = 0;

        snapshot.forEach((doc, index) => {
          const data = doc.data();
          log(`\n========== ë¬¸ì„œ ${index + 1}: ${doc.id} ==========`);
          
          // êµ¬ì¡° íŒë‹¨
          const hasDateField = 'date' in data;
          const hasDayFields = 'ì›”' in data || 'í™”' in data || 'ìˆ˜' in data;
          
          if (hasDateField && !hasDayFields) {
            dailyStructureCount++;
            log(`âœ… êµ¬ì¡°: ë‚ ì§œë³„ (ìƒˆ êµ¬ì¡°)`);
            log(`   - date: ${data.date}`);
            log(`   - userId: ${data.userId}`);
            log(`   - userName: ${data.userName || 'N/A'}`);
            log(`   - store: ${data.store || 'N/A'}`);
            log(`   - ê·¼ë¬´ì‹œê°„: ${data.startTime} ~ ${data.endTime} (${data.hours}ì‹œê°„)`);
            if (data.isShiftReplacement) {
              log(`   - ğŸ”„ ëŒ€ì²´ê·¼ë¬´`);
            }
          } else if (hasDayFields && !hasDateField) {
            weeklyStructureCount++;
            log(`âŒ êµ¬ì¡°: ì£¼ì°¨ë³„ (ê¸°ì¡´ êµ¬ì¡°) - ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”`);
            log(`   - userId: ${data.userId}`);
            log(`   - year: ${data.year}`);
            log(`   - weekNum: ${data.weekNum}`);
            log(`   - ìš”ì¼ë³„ ê·¼ë¬´:`);
            const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
            days.forEach(day => {
              if (data[day] && data[day].isWorkDay) {
                log(`     - ${day}: ${data[day].startTime} ~ ${data[day].endTime} (${data[day].hours}ì‹œê°„)`);
              }
            });
          } else {
            log(`âš ï¸ ì•Œ ìˆ˜ ì—†ëŠ” êµ¬ì¡°`);
            log(JSON.stringify(data, null, 2));
          }
        });

        // í†µê³„ í‘œì‹œ
        log(`\n========== ë¶„ì„ ê²°ê³¼ ==========`);
        log(`ì£¼ì°¨ë³„ êµ¬ì¡° (ê¸°ì¡´): ${weeklyStructureCount}ê°œ`);
        log(`ë‚ ì§œë³„ êµ¬ì¡° (ìƒˆ): ${dailyStructureCount}ê°œ`);
        
        if (weeklyStructureCount > 0 && dailyStructureCount === 0) {
          log(`\nâœ… ê²°ë¡ : ë§ˆì´ê·¸ë ˆì´ì…˜ì´ í•„ìš”í•©ë‹ˆë‹¤.`);
          log(`   ëª¨ë“  ë¬¸ì„œê°€ ì£¼ì°¨ë³„ êµ¬ì¡°ì…ë‹ˆë‹¤.`);
        } else if (weeklyStructureCount === 0 && dailyStructureCount > 0) {
          log(`\nâœ… ê²°ë¡ : ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
          log(`   ëª¨ë“  ë¬¸ì„œê°€ ë‚ ì§œë³„ êµ¬ì¡°ì…ë‹ˆë‹¤.`);
        } else if (weeklyStructureCount > 0 && dailyStructureCount > 0) {
          log(`\nâš ï¸ ê²°ë¡ : í˜¼í•© ìƒíƒœì…ë‹ˆë‹¤.`);
          log(`   ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ë¶€ë¶„ì ìœ¼ë¡œë§Œ ì™„ë£Œë˜ì—ˆê±°ë‚˜ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.`);
        }

        // í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
        document.getElementById('stats').style.display = 'grid';
        document.getElementById('totalDocs').textContent = snapshot.size;
        
        if (weeklyStructureCount > 0 && dailyStructureCount === 0) {
          document.getElementById('structureType').textContent = 'ì£¼ì°¨ë³„';
          document.getElementById('needsMigration').textContent = 'ì˜ˆ';
          document.getElementById('needsMigration').style.color = '#dc3545';
        } else if (dailyStructureCount > 0 && weeklyStructureCount === 0) {
          document.getElementById('structureType').textContent = 'ë‚ ì§œë³„';
          document.getElementById('needsMigration').textContent = 'ì•„ë‹ˆì˜¤';
          document.getElementById('needsMigration').style.color = '#28a745';
        } else {
          document.getElementById('structureType').textContent = 'í˜¼í•©';
          document.getElementById('needsMigration').textContent = 'í™•ì¸í•„ìš”';
          document.getElementById('needsMigration').style.color = '#ffc107';
        }

      } catch (error) {
        log(`\nâŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
        console.error(error);
      }
    }
  </script>
</body>
</html>
