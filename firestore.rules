rules_version = '2';

/**
 * Firestore Security Rules
 * í‘œì¤€ í•„ë“œëª… ê¸°ë°˜ (FIELD_NAMING_STANDARD.md ì¤€ìˆ˜)
 * 
 * í•µì‹¬ ì›ì¹™:
 * 1. ëª¨ë“  ë°ì´í„°ëŠ” companyIdë¡œ ê²©ë¦¬
 * 2. í‘œì¤€ í•„ë“œëª… (userId, storeId, clockIn ë“±) ê²€ì¦
 * 3. ì—­í•  ê¸°ë°˜ ê¶Œí•œ (admin, manager, store_manager, employee)
 */

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ====================================
    // í—¬í¼ í•¨ìˆ˜
    // ====================================
    
    /**
     * ì¸ì¦ëœ ì‚¬ìš©ìžì¸ì§€ í™•ì¸
     */
    function isAuthenticated() {
      return request.auth != null;
    }
    
    /**
     * ì‚¬ìš©ìžì˜ ì—­í•  ê°€ì ¸ì˜¤ê¸°
     */
    function getUserRole() {
      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role;
    }
    
    /**
     * ì‚¬ìš©ìžì˜ íšŒì‚¬ ID ê°€ì ¸ì˜¤ê¸°
     */
    function getUserCompanyId() {
      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.companyId;
    }
    
    /**
     * Admin ê¶Œí•œ í™•ì¸
     */
    function isAdmin() {
      return isAuthenticated() && getUserRole() == 'admin';
    }
    
    /**
     * Manager ì´ìƒ ê¶Œí•œ í™•ì¸
     */
    function isManager() {
      return isAuthenticated() && getUserRole() in ['admin', 'manager'];
    }
    
    /**
     * Store Manager ì´ìƒ ê¶Œí•œ í™•ì¸
     */
    function isStoreManager() {
      return isAuthenticated() && getUserRole() in ['admin', 'manager', 'store_manager'];
    }
    
    /**
     * ê°™ì€ íšŒì‚¬ ì†Œì† í™•ì¸
     */
    function isSameCompany(companyId) {
      return isAuthenticated() && getUserCompanyId() == companyId;
    }
    
    /**
     * ë³¸ì¸ ë°ì´í„° í™•ì¸
     */
    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }
    
    /**
     * Super Admin í™•ì¸ (í”Œëž«í¼ ê´€ë¦¬ìž)
     * í”Œëžœ ê´€ë¦¬, ì´ˆëŒ€ ì½”ë“œ ê´€ë¦¬, íšŒì‚¬ ê´€ë¦¬ ë“±
     */
    function isSuperAdmin() {
      return isAuthenticated() && getUserRole() == 'super_admin';
    }
    
    // ====================================
    // 1. Companies (íšŒì‚¬)
    // ====================================
    match /companies/{companyId} {
      // ì½ê¸°: ë³¸ì¸ íšŒì‚¬ë§Œ
      allow read: if isSameCompany(companyId);
      
      // ìƒì„±: íšŒì›ê°€ìž… ì‹œ
      allow create: if isAuthenticated()
        && request.resource.data.keys().hasAll(['companyId', 'companyName', 'email'])
        && request.resource.data.companyId is string
        && request.resource.data.companyName is string
        && request.resource.data.email is string;
      
      // ìˆ˜ì •: Adminë§Œ
      allow update: if isAdmin() && isSameCompany(companyId);
      
      // ì‚­ì œ: ê¸ˆì§€
      allow delete: if false;
    }
    
    // ====================================
    // 2. Users (ì‚¬ìš©ìž/ì§ì›)
    // ====================================
    match /users/{userId} {
      // ì½ê¸°: ê°™ì€ íšŒì‚¬ + Manager ì´ìƒ
      allow read: if isAuthenticated() 
        && (isOwner(userId) || (isManager() && isSameCompany(resource.data.companyId)));
      
      // ìƒì„±: íšŒì›ê°€ìž… ë˜ëŠ” Managerê°€ ì§ì› ì¶”ê°€
      allow create: if isAuthenticated()
        && request.resource.data.keys().hasAll(['userId', 'companyId', 'name', 'role'])
        && request.resource.data.userId is string
        && request.resource.data.companyId is string
        && request.resource.data.name is string
        && request.resource.data.role in ['admin', 'manager', 'store_manager', 'employee', 'staff']
        && (
          // ðŸ”’ ë³´ì•ˆ ê°•í™”: ë³¸ì¸ ê°€ìž… ì‹œ companyId ê²€ì¦
          // Case 1: Admin íšŒì›ê°€ìž… (ìžê¸° ìžì‹ ë§Œ ìƒì„± ê°€ëŠ¥)
          // ðŸ†• "ë‹­ê³¼ ë‹¬ê±€" ë¬¸ì œ í•´ê²°: Companies ì¡´ìž¬ ì²´í¬ ì œê±°
          // â†’ Companiesì™€ Usersê°€ ìˆœì°¨ì ìœ¼ë¡œ ìƒì„±ë˜ë¯€ë¡œ íƒ€ì´ë° ì´ìŠˆ ë°©ì§€
          (request.auth.uid == request.resource.data.userId 
            && request.resource.data.role == 'admin')
          // Case 2: Managerê°€ ì§ì› ì¶”ê°€ (ê°™ì€ íšŒì‚¬ë§Œ)
          || (isManager() && isSameCompany(request.resource.data.companyId))
        );
      
      // ìˆ˜ì •: ë³¸ì¸ ë˜ëŠ” Manager ì´ìƒ
      allow update: if isAuthenticated()
        && (isOwner(userId) || (isManager() && isSameCompany(resource.data.companyId)));
      
      // ì‚­ì œ: Manager ì´ìƒë§Œ
      allow delete: if isManager() && isSameCompany(resource.data.companyId);
    }
    
    // ====================================
    // 3. Contracts (ê³„ì•½ì„œ)
    // ====================================
    match /contracts/{contractId} {
      // ì½ê¸°: ê°™ì€ íšŒì‚¬ + Store Manager ì´ìƒ
      allow read: if isStoreManager() && isSameCompany(resource.data.companyId);
      
      // ìƒì„±: Store Manager ì´ìƒ
      allow create: if isStoreManager()
        && request.resource.data.keys().hasAll(['userId', 'companyId', 'storeId', 'employeeName'])
        && request.resource.data.userId is string
        && request.resource.data.companyId is string
        && request.resource.data.storeId is string
        && request.resource.data.employeeName is string
        && isSameCompany(request.resource.data.companyId);
      
      // ìˆ˜ì •: Store Manager ì´ìƒ
      allow update: if isStoreManager() && isSameCompany(resource.data.companyId);
      
      // ì‚­ì œ: Manager ì´ìƒ
      allow delete: if isManager() && isSameCompany(resource.data.companyId);
    }
    
    // ====================================
    // 4. Attendance (ì¶œí‡´ê·¼)
    // ====================================
    match /attendance/{attendanceId} {
      // ì½ê¸°: ë³¸ì¸ ë˜ëŠ” Store Manager ì´ìƒ
      allow read: if isAuthenticated()
        && (isOwner(resource.data.userId) || (isStoreManager() && isSameCompany(resource.data.companyId)));
      
      // ìƒì„±: ë³¸ì¸ ë˜ëŠ” Store Manager ì´ìƒ
      allow create: if isAuthenticated()
        && request.resource.data.keys().hasAll(['userId', 'companyId', 'storeId', 'date'])
        && request.resource.data.userId is string
        && request.resource.data.companyId is string
        && request.resource.data.storeId is string
        && request.resource.data.date is string
        // clockIn/clockOut í‘œì¤€ í•„ë“œ (ì˜µì…˜)
        && (!request.resource.data.keys().hasAny(['clockIn']) || request.resource.data.clockIn is string)
        && (!request.resource.data.keys().hasAny(['clockOut']) || request.resource.data.clockOut is string)
        // ðŸ”’ ì¶œí‡´ê·¼ ì‹œê°„ ì¡°ìž‘ ë°©ì§€ (Phase G)
        // clockInì´ ìžˆìœ¼ë©´ ì„œë²„ ì‹œê°„(request.time)ê³¼ Â±2ë¶„ ì´ë‚´ì¸ì§€ ê²€ì¦
        // TimestampëŠ” .toMillis()ë¡œ ë¹„êµ (1ë¶„ = 60,000ms)
        && (!request.resource.data.keys().hasAny(['clockIn']) 
          || (request.resource.data.clockIn is timestamp 
            && request.resource.data.clockIn.toMillis() >= request.time.toMillis() - 120000  // -2ë¶„
            && request.resource.data.clockIn.toMillis() <= request.time.toMillis() + 120000) // +2ë¶„
        )
        && (
          isOwner(request.resource.data.userId)
          || (isStoreManager() && isSameCompany(request.resource.data.companyId))
        );
      
      // ìˆ˜ì •: Store Manager ì´ìƒ ë˜ëŠ” ë³¸ì¸ (í‡´ê·¼ ì‹œê°„ ê¸°ë¡ ì‹œ)
      allow update: if isAuthenticated()
        && (
          // Case 1: Store ManagerëŠ” ëª¨ë“  ìˆ˜ì • ê°€ëŠ¥
          (isStoreManager() && isSameCompany(resource.data.companyId))
          // Case 2: ì§ì› ë³¸ì¸ì€ í‡´ê·¼ ì‹œê°„ë§Œ ìˆ˜ì • ê°€ëŠ¥ (ì‹œê°„ ì¡°ìž‘ ë°©ì§€)
          || (isOwner(resource.data.userId)
            && request.resource.data.keys().hasAny(['clockOut'])  // clockOut í•„ë“œë§Œ ìˆ˜ì •
            && request.resource.data.clockOut is timestamp
            // ðŸ”’ í‡´ê·¼ ì‹œê°„ ì¡°ìž‘ ë°©ì§€: ì„œë²„ ì‹œê°„ Â±2ë¶„ ì´ë‚´
            && request.resource.data.clockOut.toMillis() >= request.time.toMillis() - 120000
            && request.resource.data.clockOut.toMillis() <= request.time.toMillis() + 120000
          )
        );
      
      // ì‚­ì œ: Manager ì´ìƒ
      allow delete: if isManager() && isSameCompany(resource.data.companyId);
    }
    
    // ====================================
    // 5. Schedules (ê·¼ë¬´ìŠ¤ì¼€ì¤„)
    // ====================================
    match /schedules/{scheduleId} {
      // ì½ê¸°: ë³¸ì¸ ë˜ëŠ” Store Manager ì´ìƒ
      allow read: if isAuthenticated()
        && (isOwner(resource.data.userId) || (isStoreManager() && isSameCompany(resource.data.companyId)));
      
      // ìƒì„±: Store Manager ì´ìƒ
      allow create: if isStoreManager()
        && request.resource.data.keys().hasAll(['userId', 'companyId', 'storeId', 'date'])
        && request.resource.data.userId is string
        && request.resource.data.companyId is string
        && request.resource.data.storeId is string
        && isSameCompany(request.resource.data.companyId);
      
      // ìˆ˜ì •: Store Manager ì´ìƒ
      allow update: if isStoreManager() && isSameCompany(resource.data.companyId);
      
      // ì‚­ì œ: Store Manager ì´ìƒ
      allow delete: if isStoreManager() && isSameCompany(resource.data.companyId);
    }
    
    // ====================================
    // 6. Salary (ê¸‰ì—¬)
    // ====================================
    match /salary/{salaryId} {
      // ì½ê¸°: ë³¸ì¸ ë˜ëŠ” Manager ì´ìƒ
      allow read: if isAuthenticated()
        && (isOwner(resource.data.userId) || (isManager() && isSameCompany(resource.data.companyId)));
      
      // ìƒì„±: Manager ì´ìƒë§Œ
      allow create: if isManager()
        && request.resource.data.keys().hasAll(['userId', 'companyId'])
        && isSameCompany(request.resource.data.companyId);
      
      // ìˆ˜ì •: Manager ì´ìƒë§Œ
      allow update: if isManager() && isSameCompany(resource.data.companyId);
      
      // ì‚­ì œ: Adminë§Œ
      allow delete: if isAdmin() && isSameCompany(resource.data.companyId);
    }
    
    // ====================================
    // 7. Approvals (ìŠ¹ì¸ ìš”ì²­)
    // ====================================
    match /approvals/{approvalId} {
      // ì½ê¸°: ë³¸ì¸ ë˜ëŠ” Manager ì´ìƒ
      allow read: if isAuthenticated()
        && (isOwner(resource.data.userId) || (isManager() && isSameCompany(resource.data.companyId)));
      
      // ìƒì„±: ë³¸ì¸ë§Œ (ì§ì›ì´ ìš”ì²­)
      allow create: if isAuthenticated()
        && request.resource.data.keys().hasAll(['userId', 'companyId'])
        && isOwner(request.resource.data.userId)
        && isSameCompany(request.resource.data.companyId);
      
      // ìˆ˜ì •: Manager ì´ìƒ (ìŠ¹ì¸/ê±°ë¶€)
      allow update: if isManager() && isSameCompany(resource.data.companyId);
      
      // ì‚­ì œ: ë³¸ì¸ ë˜ëŠ” Manager
      allow delete: if isAuthenticated()
        && (isOwner(resource.data.userId) || (isManager() && isSameCompany(resource.data.companyId)));
    }
    
    // ====================================
    // 8. Notices (ê³µì§€ì‚¬í•­)
    // ====================================
    match /notices/{noticeId} {
      // ì½ê¸°: ê°™ì€ íšŒì‚¬ ëª¨ë“  ì§ì›
      allow read: if isAuthenticated() && isSameCompany(resource.data.companyId);
      
      // ìƒì„±: Manager ì´ìƒ
      allow create: if isManager()
        && request.resource.data.keys().hasAll(['companyId', 'title', 'content'])
        && isSameCompany(request.resource.data.companyId);
      
      // ìˆ˜ì •: Manager ì´ìƒ
      allow update: if isManager() && isSameCompany(resource.data.companyId);
      
      // ì‚­ì œ: Manager ì´ìƒ
      allow delete: if isManager() && isSameCompany(resource.data.companyId);
    }
    
    // ====================================
    // 9. Brands (ë¸Œëžœë“œ)
    // ====================================
    match /brands/{brandId} {
      // ì½ê¸°: ê°™ì€ íšŒì‚¬
      allow read: if isAuthenticated() && isSameCompany(resource.data.companyId);
      
      // ìƒì„±: Adminë§Œ
      allow create: if isAdmin()
        && request.resource.data.keys().hasAll(['companyId', 'brandName'])
        && isSameCompany(request.resource.data.companyId);
      
      // ìˆ˜ì •: Adminë§Œ
      allow update: if isAdmin() && isSameCompany(resource.data.companyId);
      
      // ì‚­ì œ: Adminë§Œ
      allow delete: if isAdmin() && isSameCompany(resource.data.companyId);
    }
    
    // ====================================
    // 10. Stores (ë§¤ìž¥)
    // ====================================
    match /stores/{storeId} {
      // ì½ê¸°: ê°™ì€ íšŒì‚¬
      allow read: if isAuthenticated() && isSameCompany(resource.data.companyId);
      
      // ìƒì„±: Adminë§Œ
      allow create: if isAdmin()
        && request.resource.data.keys().hasAll(['companyId', 'storeName'])
        && request.resource.data.companyId is string
        && request.resource.data.storeName is string
        && isSameCompany(request.resource.data.companyId);
      
      // ìˆ˜ì •: Adminë§Œ
      allow update: if isAdmin() && isSameCompany(resource.data.companyId);
      
      // ì‚­ì œ: Adminë§Œ
      allow delete: if isAdmin() && isSameCompany(resource.data.companyId);
    }
    
    // ====================================
    // 11. Invites (ì´ˆëŒ€ ì½”ë“œ)
    // ====================================
    match /invites/{inviteId} {
      // ì½ê¸°: ê°™ì€ íšŒì‚¬
      allow read: if isAuthenticated() && isSameCompany(resource.data.companyId);
      
      // ìƒì„±: Adminë§Œ
      allow create: if isAdmin()
        && request.resource.data.keys().hasAll(['companyId', 'code'])
        && isSameCompany(request.resource.data.companyId);
      
      // ìˆ˜ì •: Adminë§Œ
      allow update: if isAdmin() && isSameCompany(resource.data.companyId);
      
      // ì‚­ì œ: Adminë§Œ
      allow delete: if isAdmin() && isSameCompany(resource.data.companyId);
    }
    
    // ====================================
    // 12. Shift Requests (êµëŒ€ê·¼ë¬´ ìš”ì²­)
    // ====================================
    match /shift_requests/{shiftId} {
      // ì½ê¸°: ê°™ì€ íšŒì‚¬
      allow read: if isAuthenticated() && isSameCompany(resource.data.companyId);
      
      // ìƒì„±: ì¸ì¦ëœ ì‚¬ìš©ìž
      allow create: if isAuthenticated()
        && request.resource.data.keys().hasAll(['companyId'])
        && isSameCompany(request.resource.data.companyId);
      
      // ìˆ˜ì •: Manager ì´ìƒ
      allow update: if isManager() && isSameCompany(resource.data.companyId);
      
      // ì‚­ì œ: Manager ì´ìƒ
      allow delete: if isManager() && isSameCompany(resource.data.companyId);
    }
    
    // ====================================
    // 13. Simulators (ìŠ¤ì¼€ì¤„ ì‹œë®¬ë ˆì´í„°)
    // ====================================
    match /simulators/{simulatorId} {
      // ì½ê¸°: ì¸ì¦ëœ ì‚¬ìš©ìž (ëª¨ë“  ì‹œë®¬ë ˆì´í„° ì¡°íšŒ ê°€ëŠ¥)
      allow read: if isAuthenticated();
      
      // ìƒì„±: Store Manager ì´ìƒ
      allow create: if isStoreManager()
        && request.resource.data.keys().hasAll(['name', 'createdAt']);
      
      // ìˆ˜ì •: Store Manager ì´ìƒ
      allow update: if isStoreManager();
      
      // ì‚­ì œ: Store Manager ì´ìƒ
      allow delete: if isStoreManager();
    }
    
    // ====================================
    // 14. Signed Contracts (ì„œëª…ëœ ê³„ì•½ì„œ)
    // ====================================
    match /signedContracts/{contractId} {
      // ì½ê¸°: ê°™ì€ íšŒì‚¬ + Store Manager ì´ìƒ ë˜ëŠ” ë³¸ì¸
      allow read: if isAuthenticated()
        && ((isStoreManager() && isSameCompany(resource.data.companyId))
        || isOwner(resource.data.userId));
      
      // ìƒì„±: ë³¸ì¸ë§Œ (ì§ì›ì´ ì„œëª…)
      allow create: if isAuthenticated()
        && request.resource.data.keys().hasAll(['userId', 'companyId'])
        && isOwner(request.resource.data.userId)
        && isSameCompany(request.resource.data.companyId);
      
      // ìˆ˜ì •: ê¸ˆì§€ (ì„œëª… í›„ ìˆ˜ì • ë¶ˆê°€)
      allow update: if false;
      
      // ì‚­ì œ: Adminë§Œ
      allow delete: if isAdmin() && isSameCompany(resource.data.companyId);
    }
    
    // ====================================
    // 15. Holidays (ê³µíœ´ì¼)
    // ====================================
    match /holidays/{holidayId} {
      // ì½ê¸°: ì¸ì¦ëœ ëª¨ë“  ì‚¬ìš©ìž (ê³µíœ´ì¼ì€ ì „êµ­ ê³µí†µ ë˜ëŠ” íšŒì‚¬ë³„)
      allow read: if isAuthenticated();
      
      // ìƒì„±: Adminë§Œ (íšŒì‚¬ë³„ ê³µíœ´ì¼ ì¶”ê°€ ê°€ëŠ¥)
      allow create: if isAdmin()
        && request.resource.data.keys().hasAll(['date', 'name', 'year']);
      
      // ìˆ˜ì •: Adminë§Œ
      allow update: if isAdmin();
      
      // ì‚­ì œ: Adminë§Œ
      allow delete: if isAdmin();
    }
    
    // ====================================
    // 16. Subscription Plans (êµ¬ë… í”Œëžœ) [í”Œëž«í¼]
    // ====================================
    match /subscription_plans/{planId} {
      // ì½ê¸°: ì „ì²´ ê³µê°œ (Landing Pageì—ì„œ í”Œëžœ ëª©ë¡ í‘œì‹œ)
      // ðŸ”¥ ì¸ì¦ ë¶ˆí•„ìš” - ê³µê°œ íŽ˜ì´ì§€ì—ì„œ ì ‘ê·¼
      allow read: if true;
      
      // ìƒì„±/ìˆ˜ì •/ì‚­ì œ: Super Adminë§Œ
      // ðŸ”¥ í”Œëž«í¼ ê´€ë¦¬ìžë§Œ í”Œëžœ ê´€ë¦¬ ê°€ëŠ¥
      allow create: if isSuperAdmin()
        && request.resource.data.keys().hasAll(['name', 'price', 'features'])
        && request.resource.data.name is string
        && request.resource.data.price is number
        && request.resource.data.features is list;
      
      allow update: if isSuperAdmin();
      allow delete: if isSuperAdmin();
    }
    
    // ====================================
    // 17. Invitation Codes (í”Œëž«í¼ ì´ˆëŒ€ ì½”ë“œ) [í”Œëž«í¼]
    // ====================================
    match /invitation_codes/{codeId} {
      // ì½ê¸°: Super Adminë§Œ (API RouteëŠ” Admin SDK ì‚¬ìš©í•˜ë¯€ë¡œ Rules ìš°íšŒ)
      // ðŸ”’ ë³´ì•ˆ ê°•í™”: ì¼ë°˜ ì‚¬ìš©ìžëŠ” ì ‘ê·¼ ë¶ˆê°€, API Routeë§Œ Admin SDKë¡œ ì ‘ê·¼
      allow read: if isSuperAdmin();
      
      // ìƒì„±/ìˆ˜ì •/ì‚­ì œ: Super Adminë§Œ
      // ðŸ”¥ í”Œëž«í¼ ê´€ë¦¬ìžë§Œ ì´ˆëŒ€ ì½”ë“œ ê´€ë¦¬ ê°€ëŠ¥
      allow create: if isSuperAdmin()
        && request.resource.data.keys().hasAll(['code', 'planId', 'isUsed'])
        && request.resource.data.code is string
        && request.resource.data.planId is string
        && request.resource.data.isUsed is bool;
      
      allow update: if isSuperAdmin();
      allow delete: if isSuperAdmin();
    }
    
    // ====================================
    // 18. Open Shifts (ê¸´ê¸‰ êµ¬ì¸)
    // ====================================
    match /open_shifts/{shiftId} {
      // ì½ê¸°: ê°™ì€ íšŒì‚¬
      allow read: if isAuthenticated() && isSameCompany(resource.data.companyId);
      
      // ìƒì„±: Store Manager ì´ìƒ
      allow create: if isStoreManager()
        && request.resource.data.keys().hasAll(['companyId', 'storeId', 'date', 'startTime', 'endTime'])
        && request.resource.data.companyId is string
        && request.resource.data.storeId is string
        && request.resource.data.date is string
        && request.resource.data.startTime is string
        && request.resource.data.endTime is string
        && isSameCompany(request.resource.data.companyId);
      
      // ìˆ˜ì •: Store Manager ì´ìƒ
      allow update: if isStoreManager() && isSameCompany(resource.data.companyId);
      
      // ì‚­ì œ: Store Manager ì´ìƒ
      allow delete: if isStoreManager() && isSameCompany(resource.data.companyId);
    }
    
    // ====================================
    // 19. Notifications (ì•Œë¦¼)
    // ====================================
    match /notifications/{notifId} {
      // ì½ê¸°: ë³¸ì¸ ë˜ëŠ” Manager ì´ìƒ
      allow read: if isAuthenticated()
        && (isOwner(resource.data.userId) || (isManager() && isSameCompany(resource.data.companyId)));
      
      // ìƒì„±: Manager ì´ìƒ (ì§ì›ì—ê²Œ ì•Œë¦¼ ìƒì„±)
      allow create: if isManager()
        && request.resource.data.keys().hasAll(['userId', 'companyId', 'title', 'message'])
        && request.resource.data.userId is string
        && request.resource.data.companyId is string
        && request.resource.data.title is string
        && request.resource.data.message is string
        && isSameCompany(request.resource.data.companyId);
      
      // ìˆ˜ì •: ë³¸ì¸ ë˜ëŠ” Manager (ì½ìŒ ì²˜ë¦¬)
      allow update: if isAuthenticated()
        && (isOwner(resource.data.userId) || (isManager() && isSameCompany(resource.data.companyId)));
      
      // ì‚­ì œ: ë³¸ì¸ ë˜ëŠ” Manager
      allow delete: if isAuthenticated()
        && (isOwner(resource.data.userId) || (isManager() && isSameCompany(resource.data.companyId)));
    }
    
    // ====================================
    // ê¸°ë³¸ ê·œì¹™: ëª¨ë“  ë‹¤ë¥¸ ê²½ë¡œëŠ” ì°¨ë‹¨
    // ====================================
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
