# Phase 2 통합 테스트 체크리스트

## 📋 테스트 개요

이 체크리스트는 **Phase 2 - Multi-tenant Onboarding & Admin Experience Enhancement**의 모든 기능이 정상 작동하는지 검증하기 위한 가이드입니다.

**테스트 계정 필요:**
- super_admin 계정 (role: super_admin, companyId 있음)
- admin 계정 (role: admin, companyId 있음)
- store_manager 계정 (role: store_manager, companyId 및 storeId 있음)
- staff 계정 (role: staff, companyId 및 storeId 있음)

---

## 🚀 사전 준비

### ✅ 1. Firebase Rules 배포 확인
- [ ] Firestore Rules가 Firebase Console에 배포되었는지 확인
- [ ] Storage Rules가 Firebase Console에 배포되었는지 확인
- [ ] 배포 방법: `DEPLOY_RULES_GUIDE.md` 참조

### ✅ 2. Cloud Functions 배포 확인
- [ ] GitHub에 코드를 push했는지 확인
- [ ] GitHub Actions가 성공적으로 완료되었는지 확인 (약 3-5분 소요)
- [ ] Firebase Console → Functions 페이지에서 함수 목록 확인:
  - `createInviteCode`
  - `verifyInviteCode`
  - `recordInviteUse`

### ✅ 3. 회사 데이터 준비
- [ ] Firestore → companies 컬렉션에 테스트 회사가 1개 이상 존재
- [ ] 해당 회사의 `companyId` 확인
- [ ] 테스트 계정들의 `companyId`가 일치하는지 확인

---

## 🧪 테스트 시나리오

### 📌 Test 1: 초대 코드 생성 (super_admin/admin)

**테스트 계정**: super_admin 또는 admin

**테스트 절차**:
1. [ ] 관리자 대시보드 로그인 (https://abcdc-staff-system.web.app/admin-dashboard.html)
2. [ ] 좌측 하단 "초대 코드" 탭 클릭
3. [ ] "+ 초대 코드 생성" 버튼 클릭
4. [ ] 모달에서 다음 정보 입력:
   - 대상 매장: 드롭다운에서 매장 선택
   - 역할: staff 선택
   - 최대 사용 횟수: 10 입력
   - 만료일시: 비워둠
5. [ ] "생성" 버튼 클릭
6. [ ] **예상 결과**:
   - ✅ "생성 중..." 표시 후 성공 메시지
   - ✅ 생성된 초대 링크가 표시됨
   - ✅ 링크가 자동으로 클립보드에 복사됨
   - ✅ 초대 코드 목록에 새 코드가 추가됨

**실패 시 확인사항**:
- [ ] Browser Console에서 에러 메시지 확인
- [ ] "TypeError: firebase.functions is not a function" 에러 → Firebase Functions SDK 누락 (admin-dashboard.html Line 971 확인)
- [ ] "403 Forbidden" 에러 → createInviteCode Function 권한 문제 (DEPLOY_RULES_GUIDE.md 참조)
- [ ] "companyId 불일치" 에러 → super_admin도 자기 companyId만 생성 가능 (정상 동작)

---

### 📌 Test 2: 초대 코드로 직원 가입

**테스트 계정**: 없음 (신규 가입)

**테스트 절차**:
1. [ ] Test 1에서 생성한 초대 링크를 **시크릿 모드** 브라우저에서 열기
   - 예: `https://abcdc-staff-system.web.app/employee-register.html?code=ABC2025-STAFF-XYZ`
2. [ ] **예상 결과**:
   - ✅ 초대 코드가 자동으로 입력되어 있음
   - ✅ "URL에서 초대 코드를 자동으로 입력했습니다" 안내 메시지 표시
3. [ ] "코드 확인" 버튼 클릭
4. [ ] **예상 결과**:
   - ✅ 회사명, 매장명, 역할이 표시됨
   - ✅ 가입 폼이 나타남
5. [ ] 가입 정보 입력:
   - 이름: 테스트직원
   - 주민등록번호: 900101-1234567
   - 연락처: 010-1234-5678
   - 주소: 서울특별시 강남구
   - 직책/직무: 바리스타
   - 이메일: test-employee-001@test.com
   - 비밀번호: test1234
   - 비밀번호 확인: test1234
6. [ ] "가입하기" 버튼 클릭
7. [ ] **예상 결과**:
   - ✅ "가입 신청이 완료되었습니다!" 성공 메시지
   - ✅ 3초 후 자동으로 로그인 페이지로 이동

**실패 시 확인사항**:
- [ ] "코드 확인" 실패 → verifyInviteCode Function 문제 (Functions 배포 확인)
- [ ] "유효하지 않은 초대 코드" → 코드가 만료/비활성/사용횟수 초과
- [ ] "이미 사용 중인 이메일" → 다른 이메일 주소 사용

---

### 📌 Test 3: 초대 코드 상태 관리 (활성/중지)

**테스트 계정**: super_admin 또는 admin

**테스트 절차**:
1. [ ] 관리자 대시보드 로그인
2. [ ] "초대 코드" 탭 클릭
3. [ ] 초대 코드 목록에서 임의의 코드 선택
4. [ ] "⏸️ 중지" 버튼 클릭
5. [ ] 확인 대화상자에서 "확인" 클릭
6. [ ] **예상 결과**:
   - ✅ "초대 코드가 비활성화되었습니다" 성공 메시지
   - ✅ 해당 코드의 상태가 "비활성"으로 변경
   - ✅ 버튼이 "▶️ 활성"으로 변경
7. [ ] "▶️ 활성" 버튼 클릭하여 다시 활성화
8. [ ] **예상 결과**:
   - ✅ "초대 코드가 활성화되었습니다" 성공 메시지
   - ✅ 상태가 "활성"으로 변경

**실패 시 확인사항**:
- [ ] "Missing or insufficient permissions" → Firestore Rules 배포 확인 (DEPLOY_RULES_GUIDE.md)
- [ ] Network 탭에서 Firestore 요청 확인

---

### 📌 Test 4: 브랜딩 - 회사 로고 업로드

**테스트 계정**: admin

**테스트 절차**:
1. [ ] 관리자 대시보드 로그인
2. [ ] 우측 상단 "🏢 회사 정보" 버튼 클릭
3. [ ] 회사 정보 모달에서 스크롤하여 브랜딩 섹션 찾기
4. [ ] "로고 업로드" 버튼 클릭
5. [ ] 이미지 파일 선택 (PNG, JPG, 1MB 이하 권장)
6. [ ] **예상 결과**:
   - ✅ "로고 업로드 중..." 표시
   - ✅ 자동 압축 메시지 (512x512, JPEG 0.8)
   - ✅ "로고가 성공적으로 업로드되었습니다" 성공 메시지
   - ✅ 미리보기에 로고 표시
7. [ ] "저장" 버튼 클릭
8. [ ] 모달 닫기 후 새로고침
9. [ ] **예상 결과**:
   - ✅ 대시보드 헤더 좌측 상단에 로고 표시
   - ✅ 기본 아이콘이 숨겨짐

**실패 시 확인사항**:
- [ ] "권한 오류" → Storage Rules 배포 확인 (DEPLOY_RULES_GUIDE.md)
- [ ] "파일 업로드 실패" → Firebase Storage 설정 확인
- [ ] 브라우저 Console에서 상세 에러 확인

---

### 📌 Test 5: 브랜딩 - 회사명 및 브랜드 색상 설정

**테스트 계정**: admin

**테스트 절차**:
1. [ ] "🏢 회사 정보" 모달 열기
2. [ ] 브랜딩 섹션에서 다음 정보 입력:
   - 브랜드명: 맛남살롱
   - 브랜드 색상: #FF5722 (오렌지색)
3. [ ] "저장" 버튼 클릭
4. [ ] 모달 닫기 후 새로고침
5. [ ] **예상 결과**:
   - ✅ 대시보드 헤더에 "맛남살롱" 표시 (기존 "로딩 중..." 대신)
   - ✅ 페이지 타이틀이 "맛남살롱 - 관리자 대시보드"로 변경
   - ✅ 버튼, 링크 등의 색상이 오렌지색으로 변경

**실패 시 확인사항**:
- [ ] 브랜드명이 변경되지 않음 → loadCompanyBranding() 함수 확인 (admin-dashboard.html Line 1102)
- [ ] 색상이 적용되지 않음 → CSS 변수 적용 확인 (Line 1140-1142)

---

### 📌 Test 6: 매장 관리 - 소속 회사 컬럼 표시

**테스트 계정**: admin

**테스트 절차**:
1. [ ] 관리자 대시보드 로그인
2. [ ] "매장 관리" 탭 클릭
3. [ ] 매장 목록 테이블 확인
4. [ ] **예상 결과**:
   - ✅ 테이블 헤더에 "소속 회사" 컬럼이 있음
   - ✅ 각 매장 행에 회사명이 배지 형태로 표시됨 (파란색 배경)

**실패 시 확인사항**:
- [ ] 컬럼이 없음 → admin-dashboard.html Line 489 확인
- [ ] 회사명이 "알 수 없음" → loadStores() 함수에서 회사 정보 로딩 실패 (Line 5554-5565)

---

### 📌 Test 7: 플랫폼 대시보드 (super_admin 전용)

**테스트 계정**: super_admin

**테스트 절차**:
1. [ ] super_admin 계정으로 로그인
2. [ ] 탭 목록에서 "🌐 플랫폼 대시보드" 탭이 보이는지 확인
3. [ ] **예상 결과**:
   - ✅ "🌐 플랫폼 대시보드" 탭이 표시됨
4. [ ] 해당 탭 클릭
5. [ ] **예상 결과**:
   - ✅ 전체 회사 목록이 표시됨 (테이블 형식)
   - ✅ 각 회사별로 다음 정보 표시:
     - 회사 ID (code 형식)
     - 회사명
     - 매장 수
     - 활성 직원 수
     - 최근 7일 출석 수
     - 생성일
   - ✅ 개인정보(이름, 이메일, 급여 등) 미포함

**admin 계정으로 테스트**:
6. [ ] 로그아웃 후 admin 계정으로 로그인
7. [ ] **예상 결과**:
   - ✅ "🌐 플랫폼 대시보드" 탭이 **보이지 않음**

**실패 시 확인사항**:
- [ ] super_admin인데 탭이 안 보임 → showMainScreen() 함수에서 역할 체크 확인 (Line 1079-1081)
- [ ] "super_admin 권한이 필요합니다" 메시지 → currentUser.role이 정확히 "super_admin"인지 Firestore 확인

---

### 📌 Test 8: 역할별 메뉴 제어 - staff

**테스트 계정**: staff

**테스트 절차**:
1. [ ] staff 계정으로 admin-login.html에서 로그인 시도
2. [ ] **예상 결과**:
   - ✅ "관리자 권한이 없습니다. 직원 계정은 employee.html에서 로그인하세요." 에러 메시지
   - ✅ 자동 로그아웃
3. [ ] employee-login.html로 이동하여 staff 계정으로 로그인
4. [ ] **예상 결과**:
   - ✅ employee.html(직원 포털)로 정상 접속

**실패 시 확인사항**:
- [ ] admin-dashboard에 접속됨 → admin-login.html Line 331-337 확인

---

### 📌 Test 9: 역할별 메뉴 제어 - store_manager

**테스트 계정**: store_manager

**테스트 절차**:
1. [ ] store_manager 계정으로 로그인
2. [ ] 탭 목록 확인
3. [ ] **예상 결과**:
   - ✅ "시스템 설정" 탭이 **숨겨져** 있음
   - ✅ 다른 탭은 정상 표시
4. [ ] "매장 관리" 탭 클릭
5. [ ] **예상 결과**:
   - ✅ "+ 매장 추가" 버튼이 **숨겨져** 있음
   - ✅ 자기 매장만 표시됨 (다른 매장 안 보임)
6. [ ] "초대 코드" 탭 클릭
7. [ ] "+ 초대 코드 생성" 버튼 클릭
8. [ ] 매장 드롭다운 확인
9. [ ] **예상 결과**:
   - ✅ 자기 매장만 선택 가능 (다른 매장 안 보임)
10. [ ] 다른 매장 선택 후 생성 시도 (DevTools로 강제 변경 시)
11. [ ] **예상 결과**:
    - ✅ "점장은 자신의 매장에만 초대 코드를 생성할 수 있습니다" 에러

**실패 시 확인사항**:
- [ ] 시스템 설정 탭이 보임 → applyStoreManagerRestrictions() 확인 (Line 1204-1214)
- [ ] 모든 매장이 보임 → loadStores() 함수의 store_manager 필터 확인 (Line 5545-5551)

---

### 📌 Test 10: 역할별 메뉴 제어 - manager (읽기 전용)

**테스트 계정**: manager

**테스트 절차**:
1. [ ] manager 계정으로 로그인
2. [ ] 관리자 배지 확인
3. [ ] **예상 결과**:
   - ✅ 배지가 "매니저 (읽기 전용)"으로 표시됨 (회색)
4. [ ] 각 탭 확인:
   - [ ] "직원 관리" 탭: 수정/삭제 버튼 확인
   - [ ] "계약서 관리" 탭: "새 계약서 작성" 버튼 확인
   - [ ] "공지사항" 탭: "작성" 버튼 확인
   - [ ] "매장 관리" 탭: "+ 매장 추가" 버튼 확인
5. [ ] **예상 결과**:
   - ✅ 모든 쓰기 버튼이 **숨겨져** 있음
   - ✅ 조회는 정상 작동

**실패 시 확인사항**:
- [ ] 버튼이 보임 → applyManagerRestrictions() 확인 (Line 1163-1186)

---

### 📌 Test 11: 직원 포털 - 회사명 미표시

**테스트 계정**: staff

**테스트 절차**:
1. [ ] staff 계정으로 employee-login.html에서 로그인
2. [ ] 직원 포털(employee.html) 상단 바 확인
3. [ ] **예상 결과**:
   - ✅ 이름만 표시 (예: "김철수님")
   - ✅ 매장명만 표시 (예: "맛남살롱 부천시청점")
   - ✅ 회사명은 **표시되지 않음**
4. [ ] 브라우저 탭 타이틀 확인
5. [ ] **예상 결과**:
   - ✅ "맛남살롱 부천시청점 - 직원 포털" (회사명 없음)

**실패 시 확인사항**:
- [ ] 회사명이 보임 → js/employee.js Line 220, 223 확인

---

## 🔥 통합 시나리오 테스트

### 시나리오: 신규 직원 온보딩 전 과정

**참여자**: admin, 신규 직원

**전체 플로우**:
1. [ ] **admin**: 초대 코드 생성 (특정 매장, staff 역할)
2. [ ] **admin**: 초대 링크를 카카오톡으로 공유 (복사)
3. [ ] **신규 직원**: 링크 클릭하여 가입 페이지 접속
4. [ ] **신규 직원**: 코드 확인 → 정보 입력 → 가입 완료
5. [ ] **admin**: "직원 관리" 탭에서 신규 직원 승인 대기 확인
6. [ ] **admin**: 신규 직원 상태를 "active"로 변경 (승인)
7. [ ] **신규 직원**: employee-login.html에서 로그인
8. [ ] **신규 직원**: 직원 포털에 정상 접속

**예상 소요 시간**: 5-10분

**성공 기준**:
- [ ] 전체 과정이 에러 없이 완료
- [ ] 신규 직원이 정상적으로 직원 포털에 접속
- [ ] admin이 신규 직원 정보를 조회 가능

---

## 📊 최종 검증

### ✅ 모든 Phase 2 기능 확인

- [ ] **초대 코드 생성**: super_admin/admin/store_manager 모두 테스트 완료
- [ ] **초대 코드로 가입**: URL 파라미터 자동 입력, 에러 메시지 확인 완료
- [ ] **초대 코드 상태 관리**: 활성/중지 토글 테스트 완료
- [ ] **브랜딩 - 로고 업로드**: admin 테스트 완료, 헤더 표시 확인
- [ ] **브랜딩 - 회사명/색상**: 설정 변경 후 반영 확인
- [ ] **매장 관리 - 소속 회사 컬럼**: 테이블에 정상 표시
- [ ] **플랫폼 대시보드**: super_admin 전용, 회사별 집계 확인
- [ ] **역할별 메뉴 - staff**: 리다이렉트 확인
- [ ] **역할별 메뉴 - store_manager**: 제한된 메뉴만 표시
- [ ] **역할별 메뉴 - manager**: 읽기 전용 확인
- [ ] **직원 포털 - 회사명 미표시**: 매장명만 표시 확인

### ✅ Firestore Rules 검증

- [ ] super_admin이 모든 회사 데이터 접근 가능
- [ ] admin이 자기 회사만 접근 가능
- [ ] store_manager가 자기 매장만 접근 가능
- [ ] staff가 자기 데이터만 접근 가능
- [ ] 권한 없는 접근 시 "Missing or insufficient permissions" 발생

### ✅ Storage Rules 검증

- [ ] admin이 자기 회사 로고 업로드 가능
- [ ] super_admin이 모든 회사 로고 업로드 가능
- [ ] 다른 역할은 로고 업로드 불가
- [ ] 모든 사람이 로고 읽기 가능 (public)

---

## 🎯 테스트 완료 후

### 체크리스트 제출

테스트 완료 후 다음 정보를 정리하세요:

1. **테스트 날짜**: ____________________
2. **테스트 진행자**: ____________________
3. **총 테스트 항목**: 11개 시나리오
4. **통과**: ______개
5. **실패**: ______개
6. **실패 항목 상세**:
   - 항목명:
   - 에러 메시지:
   - 재현 방법:
7. **추가 발견 사항**:

### 배포 승인

- [ ] 모든 테스트 통과 (실패 0개)
- [ ] Firebase Rules 배포 완료
- [ ] Cloud Functions 배포 완료
- [ ] 브라우저 캐시 클리어 후 재테스트 완료
- [ ] **프로덕션 배포 승인 ✅**

---

**문의사항**: Phase 2 Implementation Team  
**최종 업데이트**: 2025-01-19
