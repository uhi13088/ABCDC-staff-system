<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì´ˆê¸° í”Œëœ ë°ì´í„° ì‹œë”©</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #f5f5f5;
      padding: 40px 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 28px;
      margin-bottom: 8px;
      color: #333;
    }
    p {
      color: #666;
      margin-bottom: 24px;
    }
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 24px;
    }
    .btn:hover {
      opacity: 0.9;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    #log {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 500px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .log-success { color: #28a745; }
    .log-error { color: #dc3545; }
    .log-info { color: #007bff; }
    .log-warning { color: #ffc107; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸŒ± ì´ˆê¸° í”Œëœ ë°ì´í„° ì‹œë”©</h1>
    <p>4ê°œì˜ ê¸°ë³¸ í”Œëœ(ìƒˆì‹¹/ì¹´í˜/ì„±ì¥/í”„ëœì°¨ì´ì¦ˆ)ì„ Firestoreì— ìƒì„±í•©ë‹ˆë‹¤.</p>
    
    <button id="seedBtn" class="btn" onclick="seedPlans()">ğŸš€ í”Œëœ ë°ì´í„° ì‹œë”© ì‹œì‘</button>
    
    <div id="log"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyCr3Tq2T7oy5rVlK1c33m_G0TlUWv0-g3k",
      authDomain: "abcdc-staff-system.firebaseapp.com",
      projectId: "abcdc-staff-system",
      storageBucket: "abcdc-staff-system.firebasestorage.app",
      messagingSenderId: "442207878284",
      appId: "1:442207878284:web:49b157573851b124d28fa9"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const logDiv = document.getElementById('log');

    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString('ko-KR');
      const className = `log-${type}`;
      logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(message);
    }

    /**
     * ì´ˆê¸° í”Œëœ ë°ì´í„°
     */
    const initialPlans = [
      {
        id: "plan_free",
        name: "ğŸŒ± ìƒˆì‹¹ (Starter)",
        price: 0,
        billingCycle: "monthly",
        maxUsers: 5,
        features: [
          "ìµœëŒ€ 5ëª…ì˜ íŒ€ì›",
          "ì§ì› ì •ë³´ ê´€ë¦¬ (ê¸‰ì—¬ í¬í•¨)",
          "ë ˆì‹œí”¼ ë“±ë¡ ë° ê´€ë¦¬",
          "ê¸°ë³¸ ëŒ€ì‹œë³´ë“œ",
          "íšŒì‚¬ ì •ë³´ ìˆ˜ì •"
        ],
        description: "ì†Œê·œëª¨ ë§¤ì¥ì˜ ê°€ë²¼ìš´ ì‹œì‘",
        permissions: [],
        isActive: true,
        isPopular: false
      },
      {
        id: "plan_basic",
        name: "â˜•ï¸ ì¹´í˜/ë§¤ì¥ (Basic)",
        price: 9900,
        billingCycle: "monthly",
        maxUsers: 15,
        features: [
          "ìµœëŒ€ 15ëª…ì˜ íŒ€ì›",
          "ëª¨ë“  ìƒˆì‹¹ í”Œëœ ê¸°ëŠ¥",
          "ğŸ“„ ë ˆì‹œí”¼ ì¸ì‡„ ìµœì í™”",
          "ğŸ”— ì™¸ë¶€ ê³µìœ  ë§í¬ ìƒì„±",
          "ì´ë©”ì¼ ì§€ì›"
        ],
        description: "í˜„ì¥ íš¨ìœ¨ì„ ìœ„í•œ í•„ìˆ˜ ê¸°ëŠ¥",
        permissions: [
          "recipe.print",
          "recipe.share_external"
        ],
        isActive: true,
        isPopular: false
      },
      {
        id: "plan_pro",
        name: "ğŸš€ ì„±ì¥í•˜ëŠ” ê¸°ì—… (Pro)",
        price: 29000,
        billingCycle: "monthly",
        maxUsers: 50,
        features: [
          "ìµœëŒ€ 50ëª…ì˜ íŒ€ì›",
          "ëª¨ë“  ì¹´í˜/ë§¤ì¥ í”Œëœ ê¸°ëŠ¥",
          "ğŸ“‹ ê·¼ë¡œê³„ì•½ì„œ ì—…ë¡œë“œ ë° ê´€ë¦¬",
          "ğŸ“… ê·¼ë¬´ ìŠ¤ì¼€ì¤„(ë¡œìŠ¤í„°) ê´€ë¦¬",
          "ğŸ“§ ì´ë©”ì¼ ìë™ ì´ˆëŒ€",
          "ìš°ì„  ì§€ì›"
        ],
        description: "ì²´ê³„ì ì¸ ì¸ì‚¬/ìŠ¤ì¼€ì¤„ ê´€ë¦¬",
        permissions: [
          "recipe.print",
          "recipe.share_external",
          "staff.manage_contract",
          "staff.schedule_manage",
          "staff.invite_email"
        ],
        isActive: true,
        isPopular: true
      },
      {
        id: "plan_enterprise",
        name: "ğŸ¢ í”„ëœì°¨ì´ì¦ˆ (Master)",
        price: 59000,
        billingCycle: "monthly",
        maxUsers: 9999,
        features: [
          "ë¬´ì œí•œ íŒ€ì›",
          "ëª¨ë“  Pro í”Œëœ ê¸°ëŠ¥",
          "ğŸ“Š Excel/CSV ë°ì´í„° ë‹¤ìš´ë¡œë“œ",
          "ğŸ”„ ë‹¤ì¤‘ ì„ íƒ ì¼ê´„ ìˆ˜ì •/ì‚­ì œ",
          "ğŸ”’ ë¹„ë²•(Secret) ë ˆì‹œí”¼ ì—´ëŒ",
          "ì „ë‹´ ê³„ì • ê´€ë¦¬ì",
          "24/7 í”„ë¦¬ë¯¸ì—„ ì§€ì›"
        ],
        description: "ë°ì´í„° ì†Œìœ  ë° ëŒ€ëŸ‰ ê´€ë¦¬",
        permissions: [
          "recipe.print",
          "recipe.share_external",
          "staff.manage_contract",
          "staff.schedule_manage",
          "staff.invite_email",
          "data.export_all",
          "data.bulk_update",
          "recipe.view_secret"
        ],
        isActive: true,
        isPopular: false
      }
    ];

    /**
     * í”Œëœ ì‹œë”© ì‹¤í–‰
     */
    async function seedPlans() {
      const btn = document.getElementById('seedBtn');
      btn.disabled = true;
      logDiv.innerHTML = '';

      log('ğŸš€ í”Œëœ ì‹œë”© ì‹œì‘...', 'info');
      log('', 'info');

      try {
        // ê¸°ì¡´ í”Œëœ í™•ì¸
        const existingPlans = await db.collection('subscription_plans').get();
        log(`ğŸ“Š ê¸°ì¡´ í”Œëœ ìˆ˜: ${existingPlans.size}ê°œ`, 'info');

        if (existingPlans.size > 0) {
          const shouldDelete = confirm(`ê¸°ì¡´ í”Œëœ ${existingPlans.size}ê°œê°€ ìˆìŠµë‹ˆë‹¤.\nëª¨ë‘ ì‚­ì œí•˜ê³  ìƒˆë¡œ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
          
          if (shouldDelete) {
            log('ğŸ—‘ï¸ ê¸°ì¡´ í”Œëœ ì‚­ì œ ì¤‘...', 'warning');
            const batch = db.batch();
            existingPlans.forEach(doc => {
              batch.delete(doc.ref);
            });
            await batch.commit();
            log(`âœ… ê¸°ì¡´ í”Œëœ ${existingPlans.size}ê°œ ì‚­ì œ ì™„ë£Œ`, 'success');
            log('', 'info');
          } else {
            log('âŒ ì‹œë”© ì·¨ì†Œë¨', 'error');
            btn.disabled = false;
            return;
          }
        }

        // ìƒˆ í”Œëœ ìƒì„±
        log('ğŸ“¦ ìƒˆ í”Œëœ ìƒì„± ì¤‘...', 'info');
        log('', 'info');

        for (const plan of initialPlans) {
          const planData = {
            ...plan,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          };

          // id í•„ë“œëŠ” ë¬¸ì„œ IDë¡œ ì‚¬ìš©í•˜ê³  ë°ì´í„°ì—ì„œ ì œê±°
          const planId = planData.id;
          delete planData.id;

          await db.collection('subscription_plans').doc(planId).set(planData);

          log(`âœ… ${plan.name}`, 'success');
          log(`   - ê°€ê²©: ${plan.price === 0 ? 'ë¬´ë£Œ' : plan.price.toLocaleString() + 'ì›/ì›”'}`, 'info');
          log(`   - ìµœëŒ€ ì¸ì›: ${plan.maxUsers === 9999 ? 'ë¬´ì œí•œ' : plan.maxUsers + 'ëª…'}`, 'info');
          log(`   - ê¶Œí•œ: ${plan.permissions.length}ê°œ`, 'info');
          log('', 'info');
        }

        log('', 'info');
        log('ğŸ‰ í”Œëœ ì‹œë”© ì™„ë£Œ!', 'success');
        log(`ì´ ${initialPlans.length}ê°œì˜ í”Œëœì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        log('', 'info');
        log('ğŸ’¡ ì´ì œ landing.htmlì—ì„œ ê°€ê²©í‘œë¥¼ í™•ì¸í•˜ì„¸ìš”!', 'info');

      } catch (error) {
        log(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
        console.error(error);
      } finally {
        btn.disabled = false;
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ì¡´ í”Œëœ í™•ì¸
    window.addEventListener('DOMContentLoaded', async () => {
      try {
        const snapshot = await db.collection('subscription_plans').get();
        log(`ğŸ“Š í˜„ì¬ ë“±ë¡ëœ í”Œëœ: ${snapshot.size}ê°œ`, 'info');
        
        if (snapshot.size > 0) {
          log('', 'info');
          log('ğŸ“‹ ë“±ë¡ëœ í”Œëœ ëª©ë¡:', 'info');
          snapshot.forEach(doc => {
            const plan = doc.data();
            log(`   - ${plan.name} (${plan.price === 0 ? 'ë¬´ë£Œ' : plan.price.toLocaleString() + 'ì›'})`, 'info');
          });
        }
        
        log('', 'info');
        log('ğŸ’¡ [í”Œëœ ë°ì´í„° ì‹œë”© ì‹œì‘] ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.', 'warning');
        
      } catch (error) {
        log(`âŒ Firestore ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
      }
    });
  </script>
</body>
</html>
