================================================================================
íŒŒì¼ëª…: .github/workflows/test.yml
ì„¤ëª…: Jest ìë™ í…ŒìŠ¤íŠ¸ ì›Œí¬í”Œë¡œìš° (PR/Push ì‹œ ìë™ ì‹¤í–‰)
================================================================================

name: Jest ìë™ í…ŒìŠ¤íŠ¸

# íŠ¸ë¦¬ê±°: main ë¸Œëœì¹˜ push, ëª¨ë“  Pull Request
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    name: í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [18.x, 20.x]
    
    steps:
      # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
      
      # 2. Node.js ì„¤ì •
      - name: ğŸŸ¢ Node.js ${{ matrix.node-version }} ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'
      
      # 3. ì˜ì¡´ì„± ì„¤ì¹˜
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: npm ci
      
      # 4. Jest í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      - name: ğŸ§ª Jest í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        run: npm test
      
      # 5. ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ ìƒì„±
      - name: ğŸ“Š ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ ìƒì„±
        run: npm run test:coverage
      
      # 6. ì»¤ë²„ë¦¬ì§€ ì—…ë¡œë“œ (Codecov)
      - name: ğŸ“¤ Codecovì— ì»¤ë²„ë¦¬ì§€ ì—…ë¡œë“œ
        uses: codecov/codecov-action@v4
        with:
          token: ${{ secrets.CODECOV_TOKEN }}
          files: ./coverage/lcov.info
          flags: unittests
          name: codecov-umbrella
          fail_ci_if_error: false
      
      # 7. í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì•„í‹°íŒ©íŠ¸ ì €ì¥
      - name: ğŸ’¾ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results-node-${{ matrix.node-version }}
          path: |
            coverage/
            jest-results.json
          retention-days: 30
