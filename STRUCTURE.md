# 시스템 구조 (System Structure)

> ABC Staff System의 사용자 계층 구조와 대시보드 구조

**버전**: v1.0.0  
**최종 업데이트**: 2024-12-16

---

## 📋 목차

1. [사용자 계층 구조](#사용자-계층-구조)
2. [플랫폼 대시보드](#플랫폼-대시보드-platform-dashboard)
3. [관리자 대시보드](#관리자-대시보드-admin-dashboard)
4. [직원 포털](#직원-포털-employee-portal)
5. [권한 매트릭스](#권한-매트릭스)

---

## 🏗️ 사용자 계층 구조

### **계층도 (Hierarchy)**

```
┌──────────────────────────────────────────────────────────────┐
│                    🌐 Platform Level                         │
│                                                              │
│  super_admin (플랫폼 관리자)                                 │
│    - 모든 회사 관리                                          │
│    - 구독 플랜 관리                                          │
│    - 초대 코드 발급                                          │
│    - Firebase Admin SDK 전체 권한                           │
│                                                              │
└──────────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────────┐
│                    🏢 Company Level                          │
│                                                              │
│  admin (회사 관리자)                                         │
│    - 회사 전체 관리                                          │
│    - 브랜드/매장 생성                                        │
│    - 관리자 추가                                             │
│    - 직원 초대 코드 발급                                     │
│                                                              │
│  manager (매니저)                                            │
│    - 직원 관리                                               │
│    - 급여 관리                                               │
│    - 승인 처리                                               │
│                                                              │
└──────────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────────┐
│                    🏪 Store Level                            │
│                                                              │
│  store_manager (매장 관리자)                                 │
│    - 매장 직원 관리                                          │
│    - 출퇴근 관리                                             │
│    - 스케줄 작성                                             │
│    - 계약서 작성/발송                                        │
│                                                              │
└──────────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────────┐
│                    👤 Employee Level                         │
│                                                              │
│  staff (직원) ⭐ 표준 명칭                                   │
│    - 본인 출퇴근 기록                                        │
│    - 본인 급여 조회                                          │
│    - 휴가/초과근무 신청                                      │
│    - 스케줄 확인                                             │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## 📊 역할 상세 설명

### 🌐 **super_admin** (플랫폼 관리자)

**권한**:
- ✅ **모든 회사 데이터 접근** (Multi-Tenant 전체)
- ✅ **구독 플랜 관리** (CRUD)
- ✅ **초대 코드 발급** (회사 가입용)
- ✅ **회사 상태 관리** (활성/정지/삭제)
- ✅ **Firestore Rules 우회** (Admin SDK)

**접근 대시보드**:
- Platform Dashboard (`/platform`)

**Firestore Rules**:
```javascript
function isSuperAdmin() {
  return isAuthenticated() && getUserRole() == 'super_admin';
}
```

---

### 🏢 **admin** (회사 관리자)

**권한**:
- ✅ **회사 정보 수정**
- ✅ **브랜드/매장 생성**
- ✅ **관리자 추가/삭제**
- ✅ **직원 초대 코드 발급**
- ✅ **급여 확인/지급**
- ✅ **공휴일 관리**
- ✅ **설정 관리**

**접근 대시보드**:
- Admin Dashboard (`/admin-dashboard`) - 13개 탭 전체

**제한 사항**:
- ❌ 다른 회사 데이터 접근 불가 (companyId 격리)
- ❌ 구독 플랜 수정 불가

---

### 👔 **manager** (매니저)

**권한**:
- ✅ **직원 관리** (승인/거부/삭제)
- ✅ **급여 관리** (확인/지급)
- ✅ **승인 처리** (휴가/초과근무)
- ✅ **공지사항 작성**
- ✅ **알림 발송**

**접근 대시보드**:
- Admin Dashboard (`/admin-dashboard`) - 일부 탭 제한

**제한 사항**:
- ❌ 브랜드/매장 생성 불가
- ❌ 관리자 추가 불가
- ❌ 설정 수정 불가

---

### 🏪 **store_manager** (매장 관리자)

**권한**:
- ✅ **매장 직원 관리**
- ✅ **출퇴근 관리** (수정 가능)
- ✅ **스케줄 작성**
- ✅ **계약서 작성/발송**
- ✅ **긴급 근무 모집**

**접근 대시보드**:
- Admin Dashboard (`/admin-dashboard`) - 제한된 탭

**제한 사항**:
- ❌ 급여 확인/지급 불가 (manager 권한 필요)
- ❌ 승인 처리 불가
- ❌ 타 매장 데이터 접근 불가 (storeId 격리)

---

### 👤 **staff** (직원) ⭐ 표준 명칭

**권한**:
- ✅ **본인 출퇴근** (QR 체크인/체크아웃)
- ✅ **본인 급여 조회**
- ✅ **본인 스케줄 조회**
- ✅ **휴가/초과근무 신청**
- ✅ **공지사항 읽기**
- ✅ **본인 프로필 수정**

**접근 대시보드**:
- Employee Portal (`/employee-dashboard`) - 8개 탭

**제한 사항**:
- ❌ 타인 데이터 접근 불가 (userId 격리)
- ❌ 관리 기능 없음

**🔥 중요**: 
- `staff`가 표준 명칭입니다.
- 기존 `employee` role은 호환성 위해 조회 시 포함됩니다.
- 신규 가입은 모두 `staff`로 저장됩니다.

---

## 🖥️ 플랫폼 대시보드 (Platform Dashboard)

**URL**: `/platform`  
**권한**: `super_admin` 전용

### **탭 구조**

| 탭 번호 | 탭 이름 | 기능 | 상태 |
|---------|---------|------|------|
| 1 | **Dashboard** | 전체 통계 (회사 수, 사용자 수, 수익) | ✅ |
| 2 | **회사 관리** | 회사 목록, 상태 관리, 삭제 | ✅ |
| 3 | **플랜 관리** | 구독 플랜 CRUD, 가격 설정, 기능 제한 | ✅ |
| 4 | **초대 코드** | 플랫폼 초대 코드 발급, 사용 현황 | ✅ |

### **주요 기능**

1. **회사 관리**
   - 전체 회사 목록 조회
   - 회사 상태 변경 (활성/정지/삭제)
   - 회사 정보 수정
   - 구독 플랜 변경

2. **플랜 관리**
   - 플랜 생성/수정/삭제
   - 가격 설정
   - 기능 제한 설정 (직원 수, 매장 수)
   - 표시 순서 조정

3. **초대 코드**
   - 플랫폼 가입용 초대 코드 발급
   - 플랜 연결
   - 사용 여부 확인
   - 만료일 설정

---

## 🏢 관리자 대시보드 (Admin Dashboard)

**URL**: `/admin-dashboard`  
**권한**: `admin`, `manager`, `store_manager`

### **탭 구조 (13개)**

| 탭 | 이름 | admin | manager | store_manager | 기능 |
|----|------|-------|---------|---------------|------|
| 1 | **Dashboard** | ✅ | ✅ | ✅ | 통계 대시보드 |
| 2 | **직원 관리** | ✅ | ✅ | ✅ | 직원 목록, 승인/거부 |
| 3 | **출퇴근 관리** | ✅ | ✅ | ✅ | 출퇴근 기록, QR 생성 |
| 4 | **급여 관리** | ✅ | ✅ | ❌ | 급여 계산, 확인/지급 |
| 5 | **승인 관리** | ✅ | ✅ | ❌ | 휴가/초과근무 승인 |
| 6 | **계약서 관리** | ✅ | ✅ | ✅ | 계약서 작성/발송 |
| 7 | **근무스케줄** | ✅ | ✅ | ✅ | 스케줄 작성, 시뮬레이터 |
| 8 | **공지사항** | ✅ | ✅ | ❌ | 공지 작성/수정/삭제 |
| 9 | **브랜드 관리** | ✅ | ❌ | ❌ | 브랜드 CRUD |
| 10 | **매장 관리** | ✅ | ❌ | ❌ | 매장 CRUD, 급여 설정 |
| 11 | **관리자 목록** | ✅ | ❌ | ❌ | 관리자 추가/삭제 |
| 12 | **초대 코드** | ✅ | ❌ | ❌ | 직원 초대 코드 발급 |
| 13 | **설정** | ✅ | ❌ | ❌ | 회사 정보, 공휴일 |

### **주요 화면**

#### **1. Dashboard (대시보드)**
```
┌─────────────────────────────────────────────────────────┐
│  📊 통계 카드                                            │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐                   │
│  │직원수│ │출근수│ │대기수│ │계약수│                   │
│  └──────┘ └──────┘ └──────┘ └──────┘                   │
│                                                         │
│  🎯 구독 정보                                            │
│  Free Plan | 직원: 3/5명 ████░░ 60%                     │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### **2. 직원 관리 (Employees)**
```
┌─────────────────────────────────────────────────────────┐
│  검색: [_____]  매장: [전체▾]  상태: [전체▾]  [동기화]  │
├─────────────────────────────────────────────────────────┤
│  이름    매장      직급    연락처        상태    액션   │
│  ────    ────────  ────    ──────────    ────    ────  │
│  홍길동  부천시청점  직원   010-1234     승인    [보기] │
│  김철수  상동점     매니저  010-5678     대기    [승인] │
└─────────────────────────────────────────────────────────┘
```

#### **3. 출퇴근 관리 (Attendance)**
```
┌─────────────────────────────────────────────────────────┐
│  날짜: [2024-12-16▾]  매장: [전체▾]  [긴급 근무 모집]   │
├─────────────────────────────────────────────────────────┤
│  날짜       직원    출근     퇴근     시간   위치  상태 │
│  ────────   ────    ────     ────     ────   ────  ──  │
│  12-16      홍길동  09:00   18:00    8h    GPS   완료  │
│  12-16      김철수  09:15   -        근무중 QR    근무  │
└─────────────────────────────────────────────────────────┘
```

---

## 👤 직원 포털 (Employee Portal)

**URL**: `/employee-dashboard`  
**권한**: `employee`, `staff`

### **탭 구조 (8개)**

| 탭 | 이름 | 기능 |
|----|------|------|
| 1 | **Dashboard** | 오늘의 출퇴근 상태, 이번 달 통계 |
| 2 | **출퇴근** | QR 체크인, 월별 근무 내역 |
| 3 | **급여** | 월별 급여 조회, PDF 다운로드 |
| 4 | **스케줄** | 주간 캘린더, 매장 전체 보기 |
| 5 | **결재** | 휴가/초과근무 신청, 내역 |
| 6 | **공지사항** | 공지 목록, 중요 공지 |
| 7 | **알림** | 알림 목록, 읽음 처리 |
| 8 | **프로필** | 개인정보, 계좌 정보 |

### **주요 화면**

#### **1. Dashboard (대시보드)**
```
┌─────────────────────────────────────────────────────────┐
│  📍 오늘의 출퇴근                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  출근 전 ⏰                                       │   │
│  │  [출근하기]                                       │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  📊 이번 달 통계                                         │
│  근무일수: 15일 | 총 근무시간: 120h | 예상 급여: 2.5M  │
└─────────────────────────────────────────────────────────┘
```

#### **2. 출퇴근 (Attendance)**
```
┌─────────────────────────────────────────────────────────┐
│  📱 QR 체크인/체크아웃                                    │
│  ┌─────────────┐                                        │
│  │  [QR 스캔]  │                                        │
│  └─────────────┘                                        │
│                                                         │
│  월 선택: [2024-12▾]                                     │
├─────────────────────────────────────────────────────────┤
│  날짜       출근     퇴근     시간   위치   상태         │
│  ────────   ────     ────     ────   ────   ────        │
│  12-16      09:00   18:00    8h    GPS    완료          │
│  12-15      09:15   18:30    8.25h QR     완료          │
└─────────────────────────────────────────────────────────┘
```

#### **3. 급여 (Salary)**
```
┌─────────────────────────────────────────────────────────┐
│  월 선택: [2024-12▾]                                     │
├─────────────────────────────────────────────────────────┤
│  월      기본급    수당     공제     실수령   상태  PDF │
│  ────    ──────    ────     ────     ──────   ────  ──  │
│  12월    2,000K    300K     250K     2,050K   지급  [📥]│
│  11월    2,000K    280K     240K     2,040K   지급  [📥]│
└─────────────────────────────────────────────────────────┘
```

---

## 🔐 권한 매트릭스

### **Firestore 컬렉션별 권한**

| 컬렉션 | super_admin | admin | manager | store_manager | employee |
|--------|-------------|-------|---------|---------------|----------|
| `companies` | ✅ 전체 | ✅ 본인 | ✅ 본인 | ✅ 본인 | ✅ 본인 |
| `users` | ✅ 전체 | ✅ 회사 | ✅ 회사 | ✅ 회사 | ✅ 본인 |
| `contracts` | ✅ 전체 | ✅ 회사 | ✅ 회사 | ✅ 회사 | ✅ 본인 |
| `attendance` | ✅ 전체 | ✅ 회사 | ✅ 회사 | ✅ 회사 | ✅ 본인 |
| `salary` | ✅ 전체 | ✅ 회사 | ✅ 회사 | ❌ | ✅ 본인 |
| `schedules` | ✅ 전체 | ✅ 회사 | ✅ 회사 | ✅ 회사 | ✅ 본인 |
| `approvals` | ✅ 전체 | ✅ 회사 | ✅ 회사 | ❌ | ✅ 본인 |
| `notices` | ✅ 전체 | ✅ 회사 | ✅ 회사 | ❌ | ✅ 회사 |
| `brands` | ✅ 전체 | ✅ 회사 | ❌ | ❌ | ❌ |
| `stores` | ✅ 전체 | ✅ 회사 | ❌ | ❌ | ❌ |
| `invitation_codes` | ✅ 전체 | ❌ | ❌ | ❌ | ❌ |
| `subscription_plans` | ✅ 전체 | ❌ | ❌ | ❌ | ❌ |

### **주요 기능별 권한**

| 기능 | super_admin | admin | manager | store_manager | employee |
|------|-------------|-------|---------|---------------|----------|
| 회사 생성/삭제 | ✅ | ❌ | ❌ | ❌ | ❌ |
| 브랜드 관리 | ✅ | ✅ | ❌ | ❌ | ❌ |
| 매장 관리 | ✅ | ✅ | ❌ | ❌ | ❌ |
| 직원 승인/거부 | ✅ | ✅ | ✅ | ❌ | ❌ |
| 급여 확인/지급 | ✅ | ✅ | ✅ | ❌ | ❌ |
| 승인 처리 | ✅ | ✅ | ✅ | ❌ | ❌ |
| 계약서 작성 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 스케줄 작성 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 출퇴근 수정 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 출퇴근 기록 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 급여 조회 | ✅ | ✅ | ✅ | ❌ | ✅ |
| 휴가 신청 | ✅ | ✅ | ✅ | ✅ | ✅ |

---

## 🔗 관련 문서

- [README.md](./README.md) - 프로젝트 개요
- [FIRESTORE_COLLECTIONS.md](./FIRESTORE_COLLECTIONS.md) - 컬렉션 명세
- [SECURITY.md](./SECURITY.md) - 보안 및 Rules

---

**최종 업데이트**: 2024-12-16  
**버전**: v1.0.0
